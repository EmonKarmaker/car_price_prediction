<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Car Price Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body class="bg-dark">

<div class="container mt-5">
    <div class="card">
        <div class="card-header text-center">
            <h1>Welcome to Car Price Predictor</h1>
        </div>
        <div class="card-body">
            <form id="predictForm">
                <div class="form-group">
                    <label><b>Select Company:</b></label>
                    <select class="form-control" id="company" name="company" required onchange="loadCarModels()">
                        {% for company in companies %}
                        <option value="{{ company }}">{{ company }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label><b>Select Model:</b></label>
                    <select class="form-control" id="car_model" name="car_models" required>
                        <option value="">Select Model</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><b>Select Year of Purchase:</b></label>
                    <select class="form-control" id="year" name="year" required>
                        {% for year in years %}
                        <option value="{{ year }}">{{ year }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label><b>Select Fuel Type:</b></label>
                    <select class="form-control" id="fuel_type" name="fuel_type" required>
                        {% for fuel in fuel_types %}
                        <option value="{{ fuel }}">{{ fuel }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label><b>Enter Kilometres Driven:</b></label>
                    <input type="number" class="form-control" id="kilo_driven" name="kilo_driven" placeholder="Enter kilometres" required>
                </div>

                <button type="button" class="btn btn-primary btn-block" onclick="sendData()">Predict Price</button>
            </form>

            <div class="mt-3 text-center">
                <h4><span id="prediction"></span></h4>
            </div>
        </div>
    </div>
</div>

<script>
    const carModels = {
        {% for company in companies %}
        "{{ company }}": [
            {% for model in car_models %}
                {% if model.startswith(company) %}
                "{{ model }}",
                {% endif %}
            {% endfor %}
        ],
        {% endfor %}
    };

    function loadCarModels() {
        const company = document.getElementById("company").value;
        const modelSelect = document.getElementById("car_model");
        modelSelect.innerHTML = "<option value=''>Select Model</option>";
        if(carModels[company]) {
            carModels[company].forEach(model => {
                const opt = document.createElement("option");
                opt.value = model;
                opt.text = model;
                modelSelect.add(opt);
            });
        }
    }

    function sendData() {
        const form = document.getElementById("predictForm");
        const fd = new FormData(form);

        document.getElementById("prediction").innerText = "Predicting...";
        fetch("/predict", {
            method: "POST",
            body: fd
        })
        .then(response => response.text())
        .then(data => {
            document.getElementById("prediction").innerText = "Prediction: â‚¹" + data;
        })
        .catch(err => {
            document.getElementById("prediction").innerText = "Error: " + err;
        });
    }
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</body>
</html>
